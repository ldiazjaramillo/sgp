<?php
$proyecto = $proyecto[0];
$nombre = $proyecto['Proyecto']['name'];
$objetivoGeneral = $proyecto['Proyecto']['objetivoGeneral'];
$fecha_inicio = $proyecto['Proyecto']['fecha_inicio'];
$fecha_culminacion = $proyecto['Proyecto']['fecha_culminacion'];
$statusOpc = array(1=>'Activo', 2=>'Inactivo', 3=>'Culminado', 4=>'Cancelado');
$fechaInicio = turnFecha($proyecto['Proyecto']['fecha_inicio'], 2);
$fechaFin = turnFecha($proyecto['Proyecto']['fecha_culminacion'], 2);
$intervalo_meses = date('n', strtotime($fechaFin)- strtotime($fechaInicio));
//echo $intervalo_meses;
$categoriasX = array();
for ($i=0; $i < $intervalo_meses; $i++) { 
	array_push($categoriasX, date('m/Y', strtotime($fechaInicio." + $i month")));	
}
$categoriasX =  json_encode($categoriasX);
?>
<h1>Proyecto: <?= $nombre ?></h1>

<?php
	$defaults = array('label'=>false, 'div'=>false);

	echo $this->Form->create('Proyecto', array('class'=>'form-horizontal', 'inputDefaults'=>$defaults));

?>
<div class="panel panel-info">
  <div class="panel-heading"><a data-toggle="collapse" href="#informacion">Información general</a></div>
  <ul class="list-group collapse in" id="informacion">
  	<li class="list-group-item">
  		<strong>Objetivo General: </strong>	<?= $objetivoGeneral ?>
  	</li>
    <li class="list-group-item">
    	<strong>Fecha de inicio: </strong> <?= $fecha_inicio ?>
    </li>
    <li class="list-group-item">
    	<strong>Fecha de culminación: </strong> <?= $fecha_culminacion ?>
    </li>
    <li class="list-group-item">
    	<strong>Coordinador: </strong> <?= $proyecto['Usuario']['fullname'] ?>
    </li>
    <li class="list-group-item">
    	<strong>Código: </strong> <?= $proyecto['Proyecto']['codigo'] ?>
    </li>
    <li class="list-group-item">
    	<strong>Presupuesto: </strong> Bs. <?= $proyecto['Proyecto']['presupuesto'] ?>
    </li>
    <li class="list-group-item">
    	<strong>Status: </strong> <?= $statusOpc[$proyecto['Proyecto']['status']] ?>
    </li>
  </ul>
</div>
<!-- MANEJO DE ARCHIVOS !-->
<div class="panel panel-info">
  <div class="panel-heading">
  Archivos <button type="button" class="btn btn-default btn-sm " data-toggle='modal' data-target="#uploader">Agregar <span class="glyphicon glyphicon-plus-sign"></span></button>
  </div>
  <div class="panel-body"> </div>
</div>
<div class="modal fade" id="uploader">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Subir archivos</h4>
      </div>
      <div class="modal-body">
        <?= $this->Element('uploader') ?>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Guardar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- FIN DEL MANEJO DE ARCHIVOS !-->
<div class="panel panel-info">
  <div class="panel-heading">
  	<a data-toggle="collapse" href="#objetivos">Objetivos especificos</a>
	  <button type="button" class="btn btn-default btn-sm ">
	  	Agregar <span class="glyphicon glyphicon-plus-sign"></span>
	  </button>
  </div>
  <div id="objetivos" class="collapse">
  <?
  $i = 0;
  if(!empty($proyecto['Objetivo'])):
  	foreach($proyecto['Objetivo'] as $objetivo){
  		$objEspecifico = $objetivo['descripcion'];
		$actividades = $objetivo['Actividad'];
  ?>
  <table class="table table-bordered table-responsive">
  	<thead>
  		<tr class='success'>
  			<th>Nro.</th>
  			<th>Descripción</th>
  			<th width="8%">Acciones</th>
  		</tr>
  	</thead>
  	<tbody>
  		<tr>
  			<td><?= $i + 1 ?></td>
  			<td><?= $objEspecifico ?></td>
  			<td class='actions'>
  				<?= $this->Html->link('<span class="glyphicon glyphicon-edit"></span>',
					array('controller'=>'Objetivos', 'action'=>'edit', $objetivo['id']), array("confirm"=>null, "indicator"=>null, "escape"=>false)); ?>
				<?= $this->Html->link('<span class="glyphicon glyphicon-trash"></span>',
			array('controller'=>'Objetivos', 'action'=>'delete', $objetivo['id'], $objetivo['proyecto_id']), array("confirm"=>"Estas seguro de eliminar este objetivo? ", "indicator"=>null, "escape"=>false)); ?>
  			</td>
  		</tr>
  	</tbody>
  </table>
<div class="panel panel-warning">
  <div class="panel-heading">Actividades
  	<a href='/' class="btn btn-default btn-sm">
		Agregar <span class="glyphicon glyphicon-plus-sign"></span>
	</a>
  </div>
  <table class='table table-bordered table-responsive'>
  	<thead>
  		<th>Nombre</th>
  		<th>Producto</th>
  		<th>Inicio</th>
  		<th>Culminación</th>
  		<th>Responsable</th>
  		<th>Peso</th>
  		<th width='8%'>Acciones</th>
  	</thead>
  	<?php
  		if(!empty($actividades)):
  			foreach($actividades as $actividad):
  				$nombre = $actividad['nombre'];
  				$producto = $actividad['producto'];
  				if(!empty($actividad['fecha_inicio'])) $inicio_actividad = $actividad['fecha_inicio'];
  				else $inicio_actividad = "";
  				if(!empty($actividad['fecha_culminacion'])) $fin_actividad = $actividad['fecha_culminacion'];
  				else $fin_actividad = "";
  				$responsable = $actividad['Usuario']['fullname'];
  				$peso = $actividad['peso'];

  	?>
  	<tbody>
  		<tr>
  			<td><?= $nombre ?></td>
  			<td> <?= $producto ?> </td>
  			<td> <?= $inicio_actividad ?> </td>
  			<td> <?= $fin_actividad ?> </td>
  			<td> <?= $responsable ?></td>
  			<td> <?= $peso ?></td>
  			<td class='actions'>
  				<?= $this->Html->link('<span class="glyphicon glyphicon-edit"></span>',
					array('controller'=>'Actividades', 'action'=>'edit', $actividad['id']), array("confirm"=>null, "indicator"=>null, 'class'=>'edit_obj', "escape"=>false)); ?>
				<?= $this->Html->link('<span class="glyphicon glyphicon-trash"></span>',
					array('controller'=>'Actividades','action'=>'delete', $actividad['id'], $objetivo['proyecto_id']), array("confirm"=>"Estas seguro de eliminar esta actividad?", "indicator"=>null, "escape"=>false));?>
  			</td>
  		</tr>
  	</tbody>
  	<?php
  			endforeach;
  		endif;
  	?>
  </table>
</div>
<? 
		$i++;
	}//end foreach
endif;
?>
 </div>
</div>